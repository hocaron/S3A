# 11 진화하는 설계 의사결정

## 도메인 변경
비즈니스 도메인의 요구사항에 따라 구동되는 소프트웨어를 설계하려면 비즈니스 하위 도메인과 해당 유형을 식별하는 것이 중요하다.  
조직이 성장하면서 하위 도메인이 다른 유형으로 변하는 일이 많다. 이런 변화를 잘 처리해야한다.  

### 핵심 -> 일반
* 배송 경로 최적화 알고리즘이 핵심 도메인이었던 소매 회사
* 더 나은 배송 경로 최적화를 가진 배송 회사가 배송관련 솔루션을 냄
* 소매 회사의 핵심 도메인은 일반 도메인이 됨

### 일반 -> 핵심
* 솔루션으로 해결하던 일반 도메인을 직접 고도화해서 핵심 도메인이 됨

### 지원 -> 일반
* 직접 구현해서 사용하던 내부 툴을 솔루션으로 교체함

### 지원 -> 핵심
* 지원 도메인의 로직이 고도화되면서 회사 수익성이 개선됨

### 핵심 -> 지원
* 복잡성에 비해 수익성이 없으면 최소한의 로직을 제외하고 제거함

### 일반 -> 지원
* 핵심 -> 지원과 같은 이유

## 전략적 설계 문제
먼소리지 ??

## 전술적 설계 문제
새로운 기능을 추가하는게 고통스러운 일이라면 설계 재평가에 대한 신호

### 트랜잭션 스크립트 -> 액티브 레코드
* 작업이 어려워지면 트랜잭션 -> 액티브 로 리팩터링
  * 복잡한 자료구조를 액티브 레코드 객체로 캡슐화
  * DB 접근 대신 액티브 레코드를 사용하여 모델, 구조 추상화

### 액티브 레코드 -> 도메인 모델
* 비즈니스 로직이 복잡해지고 불일치/중복 사례가 많으면 도메인 모델 패턴으로 리팩터링
  * VO를 식별하고, 불변 객체로 모델링하자
  * 비즈니스 로직을 VO의 일부로 만들어라
  * 태랜잭션 경계 찾기

### 도메인 모델 -> 이벤트 소싱 도메인 모델
* 데이터를 직접 수정하지 않고 AG 수명주기를 나타내는 이벤트로 모델링
* 마이그레이션할 때 과거 이벤트를 생성해야 한다. (그걸 왜 다 알아야하지?)

## 조직 변화
네~ 잘 읽었습니다~  
우리 손을 떠난 문제에 연연하지 말자..  
글쓴이는 매니저급인가?

## 도메인 지식
* 시간이 지나면서 문서는 부실해진다.
* 원래 설계자는 회사를 떠난다.
* 새로운 기능이 임시로 추가된다.
* 코드베이스는 의심스러운 상태의 레거시 시스템이 된다

## 성장
* 비즈니스가 성공하면서 규제가 없이 성장하면 설계의 복잡성을 제어할 수 없다.
* 결국 구성요소 간 경계가 허물어진 채 성장하게 된다.

### 하위 도메인 재설계
* 휴리스틱을 통해서 하위 도메인을 나누는 지점을 재설정한다.
* 모든 하위 도메인에서 핵심 하위 도메인을 최대한 추출하는 것을 목표로 한다.

### 바운디드 컨텍스트 재설계
* 모든 문제를 해결하려고 하지 말자.
* 특정 문제를 해결하는데에 초점을 맞춰서 BC를 추출하고 모델은 단순화할 수 있는 기회를 찾자.
* BC가 다른 BC를 호출하지 않고 작업할 수 없게 되면 재설계를 고려하자.
* 컨텍스트 간 자율성을 높여야 한다.

### 애그리게이트
* 강력한 일관성을 유지한다.
* 가능한 작게 유지한다.

# 12 이벤트스토밍
신속한 모델링하기 위한 활동

## 이벤트스토밍?
* 포스트잇을 활용하여 도메인 이벤트를 시간의 흐름에 따라 표현한다.
* 모델의 모든 구성요소가 비즈니스 프로세스의 작동 방식을 설명할 때 까지 개선한다.
  * 액터, 커맨, 외부 시스템 등의 개념을 모델에 추가하여 개선할 수 있다.

## 누가 참여?
* 엔지니어
* 도메인 전문가
* PO
* 테스터
* UI/UX디자이너
* 10명 이상 참여하는 것은 지양하자

## 무엇 필요?
* 포스트잇

## 과정
1. 자유로운 탐색
   * 도메인 이벤트를 브레인 스토밍
   * 과거형으로 작성
   * 떠오르는 이벤트를 뭐든지 포스트잇에 적어서 붙인다.
   * 순서, 중복을 걱정하지 않는다.
   * 포스트잇이 붙는 속도가 느려질 때까지 지속
2. 타임라인
   * 포스트잇들을 시간 순서대로 정리
   * 잘못된 것은 수정, 중복은 제거
   * 빠뜨린 이벤트도 추가
3. 고충점
   * 병목구간, 자동화 필요 구간, 도메인지식 없는 부분 등 주목할 점을 식별한다.
4. 중요 이벤트
   * 컨텍스트가 바뀌는 중요한 이벤트를 식별한다.
5. 커맨드
   * 무엇이 이벤트를 시작하게 하는지를 설명한다.
   * 명령형으로 작성한다. e.g.) 캠페인을 게시한다.
6. 정책
   * 정리하다가 현타와서 안함 
7. 읽기 모델
   *
8. 외부 시스템
   *

## 이벤트스토밍 사용 사례
* 유비쿼터스 언어 구축하기
* 비즈니스 프로세스 모델링하기
* 새로운 비즈니스 요구사항 탐색하기
* 도메인 지식 복구하기
* 존재하는 비즈니스 프로세스의 개선 방법 탐색하기
* 새로운 팀원의 훈련

## 진행 팁
* 모델링 요소에 색깔을 부여하고 진행한다. 다양한 색의 포스트잇을 준비한다.
* 참가자 적극도를 높인다.
* 원격 이벤트스토밍도 해본다. (피그마 같은거 좋은듯)