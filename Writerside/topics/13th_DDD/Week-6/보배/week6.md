# 11.  진화하는 설계 의사결정

다 읽었는데, 너무 와닿지 않는 내용들이었다. 

좀… DDD를 하고 있지 않는 상황이라 그런 비즈니스 의사결정 상황이 예상가지 않는다고 해야하나….

오히려 그런 상황에 임했을 때, 다시 읽어보면 좋을 것 같다.

---

<br/>

## 도메인 변경

조직이 성장하고 발전함에 따라 일부 하위 도메인이 한 유형에서 다른 유형으로 변하는 것은 흔한 일임.

하위 도메인이 변경함에 따라 경계 설정, 연동 조율방법, 디자인 패턴 등이 달라져야 함.

다시 복습하면

```java
핵심: 기업이 경쟁 우위를 확보하기 위해 경쟁자와 다르게 수행하는 활동
지원: 회사가 경쟁자와 다르게 하고 있지만 경쟁 우위를 제공하지 않는 활동
일반: 모든 회사가 같은 방식으로 하는 일
```

<img width="967" alt="스크린샷 2023-04-06 오후 8 15 07" src="https://user-images.githubusercontent.com/37873745/230364739-d7b48d9a-c431-455c-9434-5bdb3d8936d2.png">


<br/>


핵심 → 일반

- 다른 회사가 기존 핵심 도메인에 해당하는 아이템을 획기적으로 개선하고 이를 서비스로 제공해버리는 경우

<br/>


일반 → 핵심

- 사내 시스템이 경쟁력이 있음 → 설계 및 구축에 투자하기로 결정 → 핵심 하위도메인으로 변경
- 아마존이 AWS로 전환한 사례

<br/>


지원 → 일반

- 사내 솔루션을 구축했지만, 관련된 관리 솔루션이 오픈소스로 나온 경우

<br/>


지원 → 핵심

- 지원 도메인인데 로직이 복잡해지고, 복잡성이 증가
- 수익 발생안함? → 우발적 복잡성이므로 이를 제거, 아니라면 핵심 하위 도메인 전환 징조

<br/>


핵심 → 지원

- 복잡성에 비해 수익성이 없는 경우
- 다른 하위도메인 개발 지원하는데 필요한 최소 로직만 남겨두고 제거

<br/>


일반 → 지원

- 오픈소스 쓰다가 통합비용으로 인해 사내에 맞게 사내 개발 시스템으로 전환하는 경우

<br/>


## 전략적 설계 문제

하위 도메인의 성질에 따라 구현/연동 방법이 다르므로 하위 도메인이 바뀌면 연관된 것들이 바뀜을 인지 해야 함

<br/>


## 전술적 설계 문제

기존 설계가 복잡한 로직을 지원하지 않아서 새로운 기능을 추가하는 것이 괴롭다?

- 신호 → 비즈니스 도메인과 설계 의사결정을 재평가해봐야 함
- 현 상황에서 가장 적합한 설계 방식을 선택하고 필요할 때 개선해야 함

<br/>


다음과 같이 모델 변경을 이야기하는데, 그냥 각 방식으로 변경해나가는 과정을 설명.

- 트랜잭션 스크립트 → 액티브 레코드
- 액티브 레코드 → 도메인 모델
- 도메인 모델 → 이번트 소싱 도메인 모델

<br/>


## 조직 변화

조직 자체의 변화로 시스템 설계에 영향을 주는 경우

<br/>


파트너십, 사용자-제공자, 분리형 노선 등 조직관계도 때에 따라 변경될 수 있음.

- 상황에 보고 현재의 조직 구조보다 타 조직구조가 더 낫다면 변경할 수 있어야 함.

ex) 사용자-제공자에서 분리형 노선

- 사용자 - 제공자 조직간 심각한 의사소통의 문제 → 서로 싸우기보다 기능을 복제해서 관리하는 편이 나을 수도 있음.

<br/>


## 도메인 지식

성공적인 소프트웨어 시스템을 설계하는데 도메인 지식이 반드시 필요

- 복잡한게 문제 → 순식간에 복잡하게 변하고, 기능 추가에 따라 많은 엣지 케이스, 불변성, 규칙이 생겨남
- 도메인 로직이 불분명하고, 자주변경되면 넓은 바운디드 컨텍스트 운용이 도움 됨. 하지만 시간이 감에 따라 안정화되면 이를 마이크로 서비스로 분해하며 바운더리를 잘 설정.

<br/>


시간이 지남에 따라 도메인 지식이 손실될 수 있음

- 문서가 없거나, 전문가가 퇴사하거나, 새로운 기능이 엄청나게/임시로 만들어지다보면 ….
- 이런 퇴보를 막기 위해서는 이벤트 스토밍 같은 활동을 통해 도메인 지식을 복구하려 노력해야 함.

<br/>

## 성장

성장에 따른 복잡성을 다루는 기본 원칙 “우발적 복잡성 제거”

- 오래된 설계의 결정으로 발생하는 복잡성을 식별하고 제거하는 것
- 과거의 설계 의사결정이 비즈니스 도메인과 하위 도메인의 현재 상태에 부합하는 지 확인할 것
- **우리 인생에서 영원한 것은 변화한다는 사실 뿐**

<br/>

하위도메인/바운디드 컨텍스트/애그리게이트를 다시 살펴보면서 리팩터링 해야 함.

<br/>



# 12. 이벤트 스토밍

이벤트 스토밍

- 비즈니스 프로세스에 관해 브레인스토밍하고 신속하게 모델링하기 위한 로우테크 활동
- 비즈니스 도메인 지식을 공유하기 위한 전술적 도구

<br/>


참가자는 포스트잇을 이용해 도메인 이벤트를 시간의 흐름에 따라 표현

- 액터, 커맨드, 정책 등 다양한 개념을 표현

<br/>


누가 참가해?

- 다양한 그룹의 사람이 참가하는게 좋음. 다양한 배경의 사람들.
    - 그래야 생각의 범주가 넓어질 것. 개발자끼리만 해도 좋지 않을 것 같다.
- 단지 10명 이상이면 좀 힘들 것. 참가 독려하기가 어려움.

<br/>


필요한 것

- 공간
- 포스트잇 (다양한 색상과 크기)
- 마커
- 간식
- 회의실

<br/>


## 이벤트 스토밍 과정

### 1. 자유로운 탐색

비즈니스 도메인에 관련된 도메인 이벤트를 브레인스토밍 한다.

- 이미 발생한 이벤트에 대하여 과거형으로 작성해 붙여놓는다.
- 시간 상관없이 떠오르는 도메인 이벤트를 적는다.
- 순서/중복 고려하지 않는다. 브레인스토밍 과정이므로.

<br/>


### 2. 타임라인

생성된 도메인 이벤트를 읽어보고 비즈니스 도메인에서 발생하는 순서대로 정리한다.

<br/>


성공적인 비즈니스 시나리오인 ‘정상 시나리오’부터 시작하고 그 후에 다른 시나리오를 추가한다.

- 분기 흐름인 경우, 화살표로 표현

<br/>


잘못된 이벤트를 수정하고, 중복을 제거하며, 빠뜨린 이벤트가 있는 경우 추가한다.

<br/>


### 3. 고충점

병목구간, 자동화가 필요한 수작업 단계, 문서가 사라졌거나 도메인 지식이 없는 경우 같이 생각을 해봐야하는 부분/포인트를 표현한다.

이러한 포인트들을 표현해놔서 쉽게 돌아오거나 나중에 다시 다룰 수 있도록 한다.

물론 이 단계에서 뿐만 아니라 이후 단계에서도 고충점이 생기면 그 때마다 추가한다.

<br/>


### 4. 중요 이벤트

컨텍스트, 국면이 바뀌는 비즈니스 이벤트를 찾는다. → 중요 이벤트

이 이벤트 전후로 세로 선을 그어 표현한다.

<br/>


### 5. 커맨드

무엇이 이벤트 또는 이벤트의 흐름을 시작하게 하는지를 설명

- 이벤트의 부모 메서드 느낌

<br/>


명령형으로 작성한다.

- 주문을 제출한다.
- 로그인한다.

<br/>


특정 역할을 담당하는 액터가 특정 커맨드를 실행하면, 그 액터 정보를 포스트잇으로 추가해놓는다.

- 액터는 그 커맨드를 실시하는 대상이며, 페르소나를 나타낸다.

<br/>


### 6. 정책

커맨드에는 관련된 액터가 없는 경우가 있다.

- 커맨드를 실행할 수 있는 자동화 정책을 찾는다.

<br/>


이벤트 → 정책 → 커맨드

- `~ 정책으로 ~ 이벤트에 따라 ~ 커맨드가 실행된다.`

<br/>


어떤 의사결정 조건이 만족할 때만 커맨드를 시작해야 하면, 조건을 정책 포스트잇에 명시한다.

- VIP 유저인 경우에만 ~ 이벤트에 따라 ~ 커맨드가 실행된다.

<br/>


### 7. 읽기 모델

커맨드를 실행하는 의사결정을 내릴 때 사용하는 시각적 데이터 → 스크린/리포트/알림 등

<br/>


### 8. 외부 시스템

외부 시스템 연동 정보를 추가

- 도메인에 포함되지 않는 모든 시스템
- 커맨드를 실행할 수도 있고(입력), 도메인에서 외부 시스템으로 전달(출력)

<br/>


### 9. 애그리게이트

- 모든 이벤트/커맨드가 표현되면 애그리게이트의 개념을 포함하여 모델을 구성한다.
- 애그리게이트는 `커맨드를 받고 이벤트를 생성`한다.

<br/>


### 10. 바운디드 컨텍스트

서로 연관된 애그리게이트를 찾는다.

- 가장 밀접하게 연관되거나 정책을 통해 연관될 수 있음.
- 애그리게이트의 그룹은 바운디드 컨텍스트 경계의 자연스러운 후보가 됨.

<br/>


## 변형

위 과정을 따를 필요 없음.

- 원하는 프로세스 만 정의해서 진행해도 됨.

<br/>


**이벤트 스토밍의 진짜 가치**

- 다양한 이해관계자 간의 지식 공유
- 비즈니스와 멘탈 모델의 일치
- 충돌하는 모델의 발견
- 유비쿼터스 언어를 구축하는 과정

<br/>


## 진행 팁

- 포스트잇 종류가 많고, 색상이 많으니 헷갈릴 수 있다.
    - 이를 정리해서 범주를 한 곳에 정리해두고 참고할 수 있도록 둔다.

- 모든 참가자가 활동에 참가할 수 있도록 북돋아야 한다.
    - 활발함이 떨어지면 질문을 던지거나 다음 단계로 넘어가야 한다.
    - 그룹 활동이므로, 전체가 모델링 활동과 논의에 참여할 기회를 갖게 해야 한다.

<br/>


## 결론

이 과정을 통해 비즈니스 프로세스의 멘탈 모델을 일치시키고 유비쿼터스 언어를 사용하기 위한 첫 발을 떼게 된다.