# 3. 도메인 복잡성 관리

- 같은 비즈니스 도메인이여도 도메인 전문가마다 서로 다른 모델을 사용할 수 있음.
  - 서로 상호작용하며 의미를 추론해갈 수는 있지만 이걸 코드로 표현하는 것은 어렵다.

- 코드를 두 모델에 다 맞춰가는 것도 어렵고, 한 쪽을 위해 모델을 단순화해가는 것도 옳지 않음.
  - 전통적인 방법은 그냥 단일모델로 설계해서 사용하는 것.
    - 하지만 당연히 좋지 않다. 무엇을 하던지 복잡성에 직면하게 됨.
    - '이것저것 다 잘하는 사람은 단 한 분야에서도 달인이 될 수 없다'
  - 접두사를 붙여 분리?
    - 좋지 않음. 인지 부조화, 구현이 유비쿼터스 언어와 맞지 않음.
  - 바운디드 컨텍스트를 이용하자.

- 바운디드 컨텍스트 - 유비쿼터스 언어를 여러 개의 작은 어어로 나눠 적용할 수 있는 명시적인 컨텍스트
  - 각 바운디드 컨텍스트에서 단일 의미를 갖는 세분화된 유비쿼터스 언어는 일관성을 가질 수 있고, 도메인 전문가의 멘탈 모델을 따를 수 있음.
  - 하나의 바운디드 컨텍스트의 유비쿼터스 언어는 다른 바운디드 컨텍스트의 범위에는 완전히 관련이 없음. 즉, 완전히 분리되어져 있음. => **바운디드 컨텍스트는 유비쿼터스 언어의 일관성이 유지되는 경계**

- 바운디드 컨텍스트의 크기는 어떻게?
  - 모델의 크기에는 정답이 없음. 도메인이 무엇이냐에 따라 다름.
  - 유비쿼터스 언어의 경계가 넓을수록 일관성을 유지하기가 어렵고, 더 작고 관리하기 쉬운 문제 도메인으로 나눠 바운디드 컨텍스트를 작게 만들기 위해 노력하는 것은 역효과를 낼 수 있음.
  - 바운디드 컨텍스트를 분리하는 이유는 새로운 엔지니어링 팀을 구성하거나 시스템의 일부 비긴으 요구사항을 해결하는 것이 포함됨. ex) 컨텍스트 내 일부 컴포넌트의 개발 수명주기를 분리해야하는 경우.

- 하위 도메인은 **발견**하고, 바운디드 컨텍스트는 **설계**해야함.
  - 하위 도메인은 비즈니스 전략에 의해 정의되며, 소프트웨어 엔지니어는 소프트웨어 솔루션과 바운디드 컨텍스트를 설계함.

- 바운디드 컨텍스트의 경계
  - 물리적 경계
    - 개별 서비스/프로젝트로 구현되어야 함.
    - 다른 바운디드 컨텍스트와 구현/진화/버전관리를 독립적으로 수행해야 함.
  - 소유권 경계
    - 한 바운디드 컨텍스트는 한 팀에서만 구현, 발전, 유지관리해야 함. 단일 팀이 여러 바운디드 컨텍스트를 소유하는 것은 가능.
    - 다른 바운디드 컨텍스트와 연동을 위해서는 통신 프로토콜을 정의해 사용해야 함.

- 냉장고 구입
  - 냉장고 바닥 크기의 골판지 -> 냉장고처럼 보이지 않는다?
  - 모델은 실제 엔티티를 복사해서는 안됨. 대신 **목적/해결해야 할 문제**가 있어야 함. 즉, 골판지를 보더라도 **이 모델이 어떠한 문제를 해결하고자 하는지 봐야 함**.
  - 모든 모델이 잘못되었더라도 일부 유용함. -> 목적에 맞게 설계되었다면 이게 맞는 거임. 오히려 실제 엔티티와 갖게 만들어졌더라도 목적에 과하면 오버 엔지니어링임.
    - 즉, 모델은 당면한 작업과 관련 없는 정보는 생략해야 함.

<br/>


# 4. 바운디드 컨텍스트 연동

- 바운디드 컨텍스트는 서로 독립적으로 발전할 수 있지만, 서로 상호작용 해야 함.
  - 바운디드 컨텍스트 사이의 상호작용하기 위한 접점을 컨트랙트라고 함.


- 협력형 패턴 그룹

  - 파트너십 패턴: 연동의 조정 양방향, 이야기 많이하는 패턴.

    - API 변경 알리고 다른팀은 충돌없이 받아들임. 계속 싱크 맞춤

    - 공유커널 패턴: 공유 커널을 두고 개발
      - 수명주기가 엮임. 공유 커널이 업데이트 되면 계속 즉시 반영하도록 구성되어야 함 (연동 테스트). 전파안하면 모델의 일관성이 깨지는 것.
      - 바운디드 컨텍스트 간에 강한 의존관계를 만들 수 있음. 그렇기에 중복 비용이 조율 비용보다 클 경우에만 적용해야 함.
      - 변경이 잦을 수록 통합 비용이 늘어남. (ex. 핵심 하위 도메인) 이런 경우는 적절하지 않을 수 있음.

  - 사용자-제공자 패턴 그룹
    - 순응주의자 패턴: 힘의 균형이 업스트림(제공자)에게 있는 경우
      - 제공자는 정의된 연동 컨트랙트를 제공할 뿐
      - (ex. 조직의 외부 서비스 연동)
    - 충돌방지 계층 패턴: 다운스트림(사용자)가 업스트림(제공자)에게 순응하지 않는 경우
      - 모델 보호를 위함. 사용자가 제공자의 모델을 사용자의 요건에 맞게 번역함.
    - 오픈 호스트 서비스 패턴: 힘의 균형이 다운스트림(사용자)에게 잇는 경우
      - 인터페이스, 구현체를 분리하고 공표된 언어를 사용자에게 노출함.
      - 업스트림 바운디드 컨텍스트는 다운스트림 컨텍스트에 영향을 주지 않으면서 자신의 구현을 자유롭게 발전시킬 수 있음.



- 분리형 노선: 협력/연동보다 특정 기능을 중복으로 두는 것이 더 저렴한 경우

  - 커뮤니케이션 이슈, 일반 하위 도메인, 모델의 차이
    - 사이 안좋은 팀, 정치적 이슈
    - 서비스로 노출해 연동하는 것이 더 적절하지 않는 경우
    - 모델 간 차이가 너무 달라서 맞추는게 더 힘이 드는 경우

  - (ex. 로깅 프레임워크)

  - 핵심 하위 도메인을 연동하는 경우에는 분리형 노선은 피해야 함 -> 중요하니.



- 컨텍스트 맵

  - 컨텍스트와의 연동을 시각적으로 표현

  - 시스템의 거시적 설계 관점, 커뮤니케이션 패턴, 조직 문제에 대한 통찰력 얻을 수 있음
