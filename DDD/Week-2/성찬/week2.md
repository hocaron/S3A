## 03. 도메인 복잡성 관계
* 프로젝트 성공 보장을 위해선 유비쿼터스 언어 개발이 중요하다
  * 소프트웨어 엔지니어 ~ 도메인 전문가까지 모든 이해관계자가 원활하게 의사소통할 수 있어야 하기 때문이다.
  * 유비쿼터스 언어는 비즈니스 도메인의 내부 동작과 기본 원칙에 대한 도메인 전문가의 멘탈 모델을 반영해야 한다.
  * 언어는 명확하고 일관성 있어야 한다.
  * 언어는 모호성, 암묵적 가정, 관련 없는 세부사항이 없어야 한다.

### 현실 세계의 딜레마 - 텔레마케팅 회사
1. 회사의 마케팅 부서는 온라인 광고를 통해 리드(lead)를 생성한다.
2. 영업 부서는 잠재고객이 제품이나 서비스를 구매하도록 유도하는 역할을 한다.
3. 즉, 마케팅 부서에서의 리드는 누군가 제품에 관심이 있다는 뜻 , 영업 부서에서 리드는 영업 프로세스의 전체 생명 주기를 뜻한다.

이런 경우에 유비쿼터스 언어를 어떻게 공식화해야 할까?   
일관성 있어야 하며, 영업 부서와 마케팅 부서 각각의 도메인 전문가의 멘탈 모델도 반영해야 한다.  
이런 상황에 전통적인 솔루션은 거대한 ERD 이다. 이건 효과적이지 않다. 너무 복잡하기 때문이다.  
또 다른 솔루션은 마케팅, 영업 등 문맥상 정의를 접두사로 추가하는 것이다. 이것도 좋지 않다. 인지부하를 유발하며 구현체(소스코드)가 유비쿼터스 언어와 일치하지 않는다.  

### 해결책: 바운디드 컨텍스트
유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음에 각 언어를 활용할 수 있는 명시적인 바운디드 컨텍스트에 할당한다.
리드는 마케팅, 영업 두 컨텍스트에 존재하며 각 컨텍스트에서는 도메인 전문가의 멘탈 모델에 따라 (일관성 있게) 의미를 지닐 수 있다.

#### 바운디드 컨텍스트 범위
* 클수록 일관성 지키기 어렵다.
* 작을수록 합치기 어렵다.
* 크기에 정답은 없다. 
* 모델을 유용하게 유지하고 크기를 비즈니스 요구사항과 조직의 제약사항에 맞춰서 설정해라.
* 같은 데이터에서 작동하는 유스케이스는 세분화하지 마라. 배포 두번해야된다. (ㅇㅈ)

### 바운디드 컨텍스트 vs 하위 도메인
(둘이 다른거였어?)
* 하위 도메인은 비즈니스 도메인을 분석하고 조직이 일하는 방법과 경쟁 전략을 계획하는 방식이다. (경영느낌)
* 바운디드 컨텍스트는 엔지니어에 의해서 설계된다. 비즈니스 도메인을 어떻게 더 잘 관리할 수 있을지 고민한다.
* 하위 도메인은 발견되는 것이고 바운디드 컨텍스트는 설계되는 것이다.
* 무조건 쪼갠다고 좋은 것이 아니다. 때로는 모놀리식 BC를 유지하는게 좋을 수 있다.

### 경계
바운디드 컨텍스트 패턴은 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구이다.
* BC는 모델 경계일뿐아니라 시스템의 물리적 경계 역할도 한다.
* BC는 개별 서비스/프로젝트로 구현돼야 한다. VCS, 구현, 진화를 독립적으로 해야한다. (멀티모듈... 탈락)

### 소유권
* BC는 한 팀에서만 관리되어야 한다. 두 팀이 같은 BC 관리하면 안된다.
* 분리된 BC간 통신할 때는 프로토콜을 정의한다.
* BC와 팀은 단방향 관계이며, BC는 한 팀만 소유한다. 팀은 여러개의 BC 소유 가능하다.

### 현실의 BC
#### 시맨틱 도메인
* 모니터, 포트, 프로세서는 소프트웨어와 하드웨어 시맨틱 도메인에서 서로 다른 의미이다.
* 토마토는 식물학적 도메인에서는 과일이지만, 요리 도메인에서는 채소이다. 과세 도메인에서는 채소다. 연극 공연에서는 피드백 매커니즘이다. (ㅇㅉㄹㄱ)
* 냉장고가 차지하는 바닥 면적 크기의 골판지는 냉장고이다. 현관문을 지나갈 수 있는지 없는지 체크할 수 있기 때문이다. 
  * 당면한 작업과 관련없는 정보는 생략한다. 

## 03. 바운디드 컨텍스트 연동
BC로 분리해놨지만 결국 서로 상호작용해야한다. BC의 접점을 컨트랙트라고 부른다.  
BC 당사자들이 조율해서 컨트랙트를 정의해야 한다. 조율 패턴을 살펴보자

### 협력형 패턴 그룹
소통이 잘 되는 팀에서 사용

#### 협력형 패턴 그룹 - 파트너십 패턴
* BC간 연동을 애드혹 방식으로 조정한다.
  * 한팀은 다른 팀에게 API 변경을 알리고 다른 팀은 이를 받아들인다.
* 컨트랙트는 서로 협의한다. 
  * 연동과는 다르게 한쪽이 일방적으로 받아들이지 않는다.
* 높은 수준의 헌신, 팀 간 잦은 동기화 필수이다.
* 팀 간 지리적으로 떨어져 있는 경우 적합하지 않을 수 있다.

#### 협력형 패턴 그룹 - 공유 커널 패턴
* 모든 BC에서 모두 구현되어 사용되는 모델이 있을 수 있다. (매우 많음) 이를 공유 커널이라고 한다.
* 공유 커널은 모든 BC에서 일관성을 유지해야한다.
* 겹치는 모델(공유커널)은 모델을 포함하고 있는 BC의 수명주기에도 엮이게 한다. (왜케 단어를 "일관성"없게 쓰지? 어이없넹)
  * 공유 커널이 변경되면 BC에 즉시 영향을 줄 수 있다. 때문에 겹치는 부분을 최소화한다.
  * 연동관련 컨트랙트와 자료구조만으로 구성하는 것이 이상적이다.
* 공유 커널이 변경되면 BC에 즉시 영향을 줄 수 있어야 한다.
  * 때문에 공유 커널 변경에 대한 테스트가 지속적으로 이루어져야 한다.
* 공유 커널 유지 여부 결정 기준은 중복 비용과 조율 비용의 비율
  * 공유 커널의 변동성에 주목하라
    * 변경이 잦을수록 통합 비용은 높아진다.
* 공유 커널은 단일 팀 원칙을 위반한다.

### 사용자-제공자 패턴 그룹
구성요소 
* 제공자(upstream)
* 사용자(downstream)

#### 사용자-제공자 패턴 그룹 - 순응 주의자 패턴
제공자는 변경하고 사용자는 받아들인다(순응한다).

#### 사용자-제공자 패턴 그룹 - 충돌 방지 계층 패턴
* 사용자는 충돌 방지 계층(ACL: anticorruption layer)을 둬서 제공자의 모델을 필요에 따라 가공한다.  
* 제공자의 모델을 따르고 싶지 않거나 따르는데에 드는 노력이 가치가 없을 때 사용한다. (9장이 기대된다)

#### 사용자-제공자 패턴 그룹 - 오픈 호스트 서비스(OHS: open-host service) 패턴
* 주도권이 사용자에게 있을 때를 다룬다.
* 제공자는 사용자를 보호하고 최고의 서비스를 제공하는데에 관심이 있다.
* 제공자는 퍼블릭 인터페이스와 내부 구현체를 분리한다.
* 연동 지향 언어(integration-oriented language)로 인터페이스를 정의한다. (유비쿼터스 언어가 아닌)
* 새로운 버전으로 이관하기 좋게 한다.

### 분리형 노선 
협업 안한다. 왜 안할까?

#### 분리형 노선 - 커뮤니케이션 이슈
정치 이슈

#### 분리형 노선 - 일반 하위 도메인
* 하위 도메인이 중복되었을 때 분리하는게 나을 수 있다.
* 로그 찍는 것. 솔루션 여동하는 것보다 기능을 중복하는 것이 저렴하다.

#### 분리형 노선 - 모델의 차이
모델이 너무 달라서 받아들일 수 없는 경우

### 컨텍스트 맵
BC 간 연동을 CM으로 그릴 수 있다. 시각적으로 표현하면 다양한 수준에서 전략적 통찰력을 제공한다.
* 거시적 설계 관점
* 커뮤니케이션 패턴
* 조직 문제
CM은 지속적으로 유지보수해야한다. 모든 팀이 다 함께 유지보수해야한다.

