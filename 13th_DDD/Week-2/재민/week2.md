# 3~4

# 3. 도메인 복잡성 관리

조직 규모에 따라 도메인 전문가의 멘탈 모델에 일관성이 없을 수 있다. 이런 경우 같은 비즈니스 도메인의 경우에도 서로 다른 모델이 존재할 수 있다.

---

## 일관성 없는 모델

마케팅 부서에서 ‘리드’라는 용어와 영업 부서에서 ‘리드’라는 용어의 충돌이 있을 경우 이를 어떻게 공식화 해야 할까?

### 공식화하는 잘못된 방법

1. 아주 거대한 ERD를 생성
    1. 항상 복잡성에 직면한다
    2. 모두를 이해하긴 너무 어렵다
    3. 유지보수가 어렵다
2. prefix로 해당 영역을 적는방법 ex) 영업리드, 마케팅리드
    1. 이는 모델의 구현이 유비쿼터스 언어와 일치하지 않는다
    2. 인지부하를 유발한다

---

## 바운디드 컨텍스트란 무엇인가?

도메인 주도 설계에서 위 문제는 유비쿼터스 언어를 여러 개의 작은 언어로 나눌 수 있는 바운디드 컨텍스트라는 개념이 있다. 앞선 예로 영업 부서와 마케팅 부서가 서로 다른 바운디드 컨텍스트가 되고 서로 다른 유비쿼터스 언어를 갖으면 된다!

### 모델 경계

이전에 지도의 예시처럼 모델은 특정 목적 범위 내에서만 유용하고 일관성이 있다. 바운디드 컨텍스트도 컨텍스트 내부에서 사용하는 유비쿼터스가 어떠한 모델을 따르는지 정의할 수 있어야 한다.

### 정제된 유비쿼터스 언어

유비쿼터스 언어는 조직 전체에서 일관되게 사용되어야 하는 완벽한 언어가 아니다. 유비쿼터스 언어는 해당 바운디드 컨텍스트 경계 안에서만 보편적으로 적용되며 해당 컨텍스트에 포함된 모델을 설명하는데만 집중하면 된다.

### 바운디드 컨텍스트 범위

바운디드 컨텍스트를 정의하는 것은 전략적인 설계 의사결정이다. 바운디드 컨텍스트의 크기에 대한 결정은 문제 도메인이 무엇이냐에 따라 달라진다. 때로는 넓은 경계가 더 명확하고, 어떤 경우에는 분해하는 것이 더 합리적이다.

즉, 모델을 유용하게 유지하고 바운디드 컨텍스트의 크기를 전략적으로 비즈니스 요구사항과 조직의 계약사항에 맞춰라. 다만, 응집된 기능을 여러 컨텍스트로 분할하지 마라! 이는 각 컨텍스트가 독립적으로 발전하는 능력을 저해한다.

---

## 바운디드 컨텍스트 vs 하위 도메인

### 하위 도메인

하위 도메인은 비즈니스 전략을 이해하기 위해 비즈니스 도메인을 분석하는 단계에서 정해진다. 응집된 유즈케이스의 결정체인데, 이는 비즈니스 도메인과 시스템 요구사항에 다라 정의된다.

### 바운디드 컨텍스트

바운디드 컨텍스트는 소프트웨어 엔지니어에 의해 설계된다. 모델의 경계를 선택하는 것은 전략적 설계의 의사결정이다.

### 하위 도메인과 바운디드 컨텍스트 사이의 상호작용

**모놀리식 바운디드 컨텍스트**

- 단일 모델이 전체 비즈니스 도메인인 경우 적용

모놀리식 바운디드 컨텍스트 내부에서 도메인 전문가의 멘탈 모델에 따라 시스템을 바운디드 컨텍스트로 분해할 수 있다. 이 이후에도 모델이 여전히 크고 유지보수하기 어려운 경우 더 작은 바운디드 컨텍스트로 분해할 수 있다.

→ **하위 도메인은 발견하고 바운디드 컨텍스트는 설계한다**

---

## 경계

바운디드 컨텍스트 패턴은 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구이다.

### 물리적 경계

바운디드 컨텍스트는 모델 경계뿐 아니라 시스템의 물리적 경계 역할도 한다. 바운디드 컨텍스트는 서로 다른 프로젝트 및 서비스로 구현되어야 한다. 바운디드 컨텍스트는 여러 하위 도메인을 갖을 수 있는데 이는 논리적 경계이다. 소프트웨어식으로 네임스페이스, 모듈, 패키지 등의 이름을 갖는다

### 소유권 경계

바운디드 컨텍스트는 한 팀에서만 구현, 발전, 유지 관리해야 한다. 서로 다른 팀이 같은 바운디드 컨텍스트를 공유할 수 없다. 다만, 단일 팀이 여러 개의 바운디드 컨텍스트를 갖을 수 있다.

---

## 실생활의 바운디드 컨텍스트

### 시맨틱 도메인

시맨틱 도메인이란 의미 영역과 해당 의미를 전달하기 위해 사용하는 단어 영역으로 구분한다. 시맨틱 도메인의 예를 하나 들어보자.

### 냉장고 구입

냉장고를 구매하기 위해 골판지로 냉장고 하부의 너비를 본 뜰 수 있다. 이는 내 집에 냉장고를 위치시킬 수 있을지 알기 위한 좋은 모델이 될 수 있다. 만약 적합한 높이에 대한 모델이 필요하다면 줄자는 좋은 모델이 될 수 있다. 이처럼 냉장고라는 의미가 ‘줄자’나 ‘골판지’라는 모델을 통해 표현될 수 있다.

---

# 4. 바운디드 컨텍스트 연동

바운디드 컨텍스트는 서로 독립적이지만 협력할 수 있어야 한다. 결국, 바운디드 컨텍스트 사이에는 항상 접점이 있는데 이를 **컨트랙트**라고 부른다. 바운디드 컨텍스트 간의 관계와 연동을 정의하는 도메인 주도 설계 패턴에 대해 배워보자.

---

## 협력형 패턴 그룹

소통이 잘 되는 팀에서 구현된 바운디드 컨텍스트와 관련있다

### 파트너십 패턴

각 컨텍스트 간의 연동은 애드혹 방식으로 조정하는 패턴이다. 한 팀에서 API 변경이 일어나면 다른 팀은 이를 충돌 없이 받아들인다. 이 연동의 조정은 양방향에서 한다. 서로 팀간의 차이점을 이해하고 함께 해결하고 가장 적절한 솔루션을 선정한다. 성공적인 연동을 위해서는 잘 구축된 협업 실무, 높은 수준의 헌신, 잦은 동기화가 필수다. 기술적 관점에서 보면 연동의 피드백 경로를 더욱 최소화하기 위해 양 팀간의 지속적인 통합이 필요하다

### 공유 커널 패턴

바운디드 컨텍스트 모델의 경계임에도 불구하고 공통적으로 변경 및 개발이 필요한 모델, 혹은 그의 일부분을 모두가 소유하는 경우 사용된다. 

겹치는 형태의 모델은 해당되는 바운디드 컨텍스트의 수명주기도 엮이게 된다. 공유 모델의 변경이 있을 경우 다른 모든 바운디드 컨텍스트에 즉시 영향을 준다. 그러므로 노출되는 범위를 최소화해야 한다. 더불어 코드단의 공유도 일어나기에 공유 모델의 변경이 있을 경우 해당되는 바운디드 컨텍스트와 연동 테스트를 수행해야 하며 지속적인 통합이 이뤄져야 한다.

공유 커널 패턴을 사용할 경우 중복 비용과 조율 비용의 비율을 잘 따져보고 선택해야 한다. 각 컨텍스트간의 강한 의존관계를 만들기 때문에 중복 비용이 조율 비용보다 클 경우에만 적용해야 한다.

---

## 사용자-제공자 패턴 그룹

제공자는 사용자에게 서비스를 제공하는 패턴이다. 서비스 제공자는 **업스트림**, 사용자는 **다운스트림**이다. 양 팀은 서로 독립적으로 성공할 수 있다. 이 경우 각 팀간의 권력의 불균형이 존재하는데 이런 불균형을 기준으로 세 가지 패턴을 소개한다.

### 순응주의자 패턴

힘의 균형이 서비스 제공자에게 있는 경우이다. 업스트림 팀이 노출한 컨트랙트가 산업 표준이거나 잘 구축된 모델인 경우 사용자 팀은 팀의 요건이 충분하면 어느정도 팀의 자율성을 포기하는 결정을 할 수 있다.

### 충돌 방지 계층 패턴

순응주의자 패턴에서 사용자 팀이 업스트림에 순응하지 않을 경우 사용될 수 있다. 

1. 다운스트림 바운디드 컨텍스트가 핵심 하위 도메인을 포함할 경우
2. 업스트림 모델이 사용자의 요건에 비효율적이거나 불편한 경우
3. 제공자가 컨트랙트를 자주 변경하는 경우

위의 경우일 경우 충돌 방지 계층을 두어 서비스 제공자가 제공하는 서비스를 가공하여 받아들인다.

### 오픈 호스트 서비스 패턴

이 패턴은 힘이 사용자 측에 있을 경우에 사용된다. 서비스 제공자는 사용자를 보호하기 위해 퍼블릭 모델과 내부 구현을 분리시킨다. 사용자는 퍼블릭 모델을 기준으로 서비스 제공을 받으니 보호되고 서비스 제공자는 내부 구현을 변경시켜도 퍼블릭 모델에는 영향을 주지 않으니 퍼블릭 모델과 내부 구현이 서로 다른 속도로 개발 될 수 있는 유연함을 갖을 수 있다. 또한 서비스 제공자는 연동 모델을 분리해 이미 공표된 언어의 여러 버전을 동시에 노출해 사용자가 점진적으로 새로운 버전으로 이관될 수 있게 한다.

---

## 분리형 노선

협력하지 않을 경우 사용할 수 있는 패턴에 대해 다룬다.

### 커뮤니케이션 이슈

조직의 규모나 내부 정치 요인으로 인해 커뮤니케이션이 불가한 경우 기능의 중복 이슈를 감당하더라도 각자의 노선을 가는 방향이 있다.

### 일반 하위 도메인

일반 하위 도메인이 일반 솔루션과 연동되는 것이 쉽다면 각 바운디드 컨텍스트 내에서 각자 연동하는 것이 더욱 비용 효과적일 수 있다.

### 모델의 차이

바운디드 컨텍스트의 모델 간의 차이가 너무 커서 순응주의자 관계나, 충돌 방지 계층을 구현하는 것도 기능 중복보다 비용이 더 클 수 있다.

---

## 컨텍스트 맵

시스템의 바운디드 컨텍스트 간의 연동 패턴을 분석하면 컨텍스트 맵을 그릴 수 있다.

컨텍스트 맵은 시스템의 바운디드 컨텍스트와의 연동을 시각적으로 표현한다. 시각적 표현법은 다양한 수준의 통찰력을 제공한다

1. 거시적 설계 관점
2. 커뮤니케이션 패턴
3. 조직적 문제

### 유지보수

컨텍스트 맵은 프로젝트 초기부터 구축하여 여러 팀이 다 함께 유지보수하는 것이 제일 좋다.

### 한계

컨텍스트 맵을 작성하는 것은 어렵다.각 바운디드 컨텍스트간에는 작동하는 여러 연동 패턴이 있을 수 있기 때문이다!
