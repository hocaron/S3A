# 7장 스프링 핵심기술의 응용

## 7.5 DI를 이용해 다양한 구현 방법 적용하기

### 7.5.2 내장형 데이터베이스를 이용한 SQL 레지스트리 만들기

#### 내장형 DB를 이용한 SqlRegistry 만들기

UpdatableSqlRegistry 테스트 코드의 재사용
ConcurrentHashMapSqlRegistry, EmbeddedDbSqlRegistry의 테스트 방법 차이 X  
-> 상속을 통한 테스트 코드 재사용(JUnit4.x 이상부터 테스트 클래스 상속구조 가능)

![image](https://user-images.githubusercontent.com/18495291/235968155-9dddc177-bbcd-4228-ab48-2f139b4c5b42.png)  
- UpdatableSqlRegistry 구현 클래스의 오브젝트 생성 부분만 분리되면 나머지 코드 공유 가능  
![image](https://user-images.githubusercontent.com/18495291/235968255-21d552ac-8af1-4d3e-8805-5c0bb60c3ab8.png) 

![image](https://user-images.githubusercontent.com/18495291/235969785-ff65e484-4192-4425-af66-94df31aeb458.png)
- createUpdatableSqlRegistry()만 EmbeddedDbSqlRegistry를 사용할 수 있도록 구현하면 모든 테스트 동일 수행 가능  

#### XML 설정을 통한 내장형 DB의 생성과 적용

![image](https://user-images.githubusercontent.com/18495291/235971080-156a66f3-3521-4b13-a6b3-31ca9cdd4669.png)
- 팩토리빈을 통한 embeddedDatabase 빈 생성  
![image](https://user-images.githubusercontent.com/18495291/235971312-fd315b1a-a790-4491-b0a3-6de7d96cc095.png)
- dataSource 프로퍼티로 embeddedDatabase DI  
-> DataSource 인터페이스의 기능만 사용할것이기 때문  
EmbeddedDatabase 타입의 빈은 스프링 컨테이너가 종료되는 시점에 자동으로 shutdown() 메소드 호출  

### 7.5.3 트랜잭션 적용  
