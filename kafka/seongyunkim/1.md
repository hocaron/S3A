# 01. 카프카란 무엇인가

- 현대 컴퓨팅 아키텍처
    - 클라우드 시대에 컴퓨팅 리소스는 더 이상 영속적이지 않음
        - 느슨한 결합으로 이뤄진 컴퓨팅 아키텍처 (비동기 메세징 프레임워크)
    - 데이터의 중앙화
        - 컴퓨팅 성능의 향상으로 많은 서비스에서 생성되는 이벤트를 모아도 부하를 견딜 수 있음

## 카프카의 탄생 배경

- end to end 연결 방식의 문제점
    - 실시간 트랜잭션 처리와 비동기 처리가 동시에 이뤄지지만 통합된 전송 영역이 없어 복잡도가 증가
    - 데이터 파이프라인 관리의 어려움

### 카프카 목표

- 프로듀서와 컨슈머의 분리 (모든 시스템으로 데이터를 전송할 수 있음)
- 영구 메세지 데이터를 여러 컨슈머에게 허용
- 높은 처리량을 위한 메세지 최적화 (실시간 처리 가능)
- 데이터 증가에 따라 스케일아웃이 가능한 시스템 (확장 용이)

### 카프카 장점

- 카프카 중심 데이터/이벤트 연결 (표준 포맷)
- 신뢰성 높은 **실시간 분석**
- 카프카에 데이터만 전달하면 나머지는 필요한 곳에서 가져갈 수 있도록

## 카프카의 동작 방식과 원리

### pub-sub 모델

- 프로듀서가 카프카 토픽(메세지 저장소)에 데이터를 저장하면
- 컨슈머가 원하는 카프카 토픽에서 데이터를 가져감

### 직접 통신 vs 기존 메세징 시스템 vs 카프카

- 직접 통신
    - 장점
        - 빠른 전달 속도
        - 결과를 바로 알 수 있음
    - 단점
        - 받는 쪽에 장애가 발생한 경우 메세지 유실 가능
        - 통신 참여 개체가 많아질수록 일일이 연결해야 함 (확장성이 안좋음)
- 기존 메세징 시스템 (교환기 방식)
    - 교환기가 수신처 ID를 확인 후 컨슈머 큐에 전달
    - 컨슈머는 큐를 모니터링하며 메세지를 가져감
    - 장점
        - 받는 쪽에 장애가 발생해도 메세지 유실 X
        - 다대다 직접 통신을 하지 않고 메세징 시스템을 중심으로 연결하기 때문에 확장에 용이
    - 단점
        - 직접 통신 하지 않기 때문에, 메세지 전달 여부를 바로 확인할 수 없음
        - 중간에 메세징 시스템이 있기 때문에, 전달 속도가 빠르지 않음
        - 교환기, 컨슈머 큐 등 내부 프로세스가 복잡해 속도, 용량이 좋지 않음 → 대규모 데이터 보다는 간단한 이벤트 전달 위주로
- 카프카
    - 장점
        - 기존 비동기 메세징 시스템 + 고성능 메세징 시스템을 위해
            - 메세지 전달의 신뢰성 관리를 프로듀서와 컨슈머로
            - 교환기 기능을 컨슈머로

## 카프카의 특징

- 프로듀서와 컨슈머의 분리
    - 프로듀서는 카프카로 메세지를 보내기만. 컨슈머는 카프카에서 메세지를 가져오기만
    - 어느 한 쪽에 문제가 발생해도 연쇄 장애로 이어지지 않음
    - 개체가 추가되어도 카프카와 연결만 하면 됨 (확장성)
- 멀티 프로듀서, 멀티 컨슈머
    - 하나의 토픽에 여러 프로듀서, 컨슈머가 접근 가능
    - 하나의 데이터를 다양한 용도의 분석에 사용하는 등 복잡한 요구 사항 대응 가능
- 디스크에 메세지 저장
    - 일반적인 메세징 시스템은 컨슈머가 메세지를 읽으면 큐에서 메세지를 바로 삭제
    - 카프카는 일정 보관 주기 동안 디스크에 메세지를 저장 (손실 X)
    - 컨슈머에 버그가 있을 때 다시 메세지를 읽을 수도 있음 (?)
- 확장성
    - 3대부터 수십 대의 브로커로 확장 가능 (서비스 중단 없이)
- 높은 성능

### 카프카 용어

- 브로커: 카프카 애플리케이션이 설치되어 있는 서버
- 토픽: 카프카로 보낸 메세지를 구분하기 위한 네임
- 파티션: 병렬 처리가 가능하도록 토픽을 나누고, 많은 양의 메세지 처리를 위해 파티셔 수를 늘릴 수 있음

## 카프카의 확장과 발전

- ESB (Enterprise Service Bus)
    - 다양한 시스템과 연동하기 위한 멀티 프로토콜, 데이터 타입 지원
    - 느슨한 결합을 위한 메세지 큐 지원
    - 정기적으로 데이터를 가져오는 대신 이벤트 기반 통신 지향
- 확장과 발전
    - 카프카 스트림즈, KSQL을 통한 실시간 분석