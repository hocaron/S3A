### 4.1.3 부하 테스트
- 처리율이나 스트레스 테스트와는 다름
- 이 정도 부하는 견딜 수 있을까 없을까의 예/아니오
- 부하테스트 ci 개발을 했는데 사실 이건 부하테스트가 아니었구나...
- 어디에 속하는걸까 그나마 용량 계획 테스트?

### 4.1.4 스트레스 테스트
- 시스템 여력이 어느 정도인지 알아보는 수단
- 일정한 처리율을 계속 걸어놓음
- 측정값이 나빠지기 직전의 값이 최대 처리율

### 4.1.5 내구 테스트
- 메모리 누수, 캐시 오염, 메모리 단편화 
- CMS GC를 쓰는 애플리케이션은 CMF가 결국 발생
    - Concurrent Mode Failure는 Old영역에 더 이상 메모리를 할당할 공간이 없을 때 발생
    - Old 영역의 빈 공간이 충분히 존재함에도 불구하고 크기가 큰 객체를 할당할 수 없는 경우
    - 강제로 compaction 수행하므로 stop the world
- 시스템에 일정 부하를 계속 주다가 갑자기 리소스가 고갈되거나 시스템이 깨지는 지점을 찾음
- 빠른 응답을 요구하는 시스템에서 많이 함
    - 우리 팀. full gc가 일어나면 안됨

### 4.1.6 용량 계획 테스트
- 업그레이드 한 시스템이 어느 정도 부하를 감당할 수 있을지 미리 봄

### 4.1.7 저하 테스트
- 부분 실패 테스트
- 평상시 운영 환경과 동등한 부하를 가하다가 어떤 컴포넌트가 갑자기 능력을 상실하는 시점에 벌어지는 일
- chaos monkey: 넷플릭스에서 유명한 테스트
- 조직 차원에서 시스템 위생, 서비스 설계, 운영 탁월성을 최고 수준으로 확보해야 함
    - 이중화.. 과거 판교 idc 화재
    - 하려면 끝도없음. 리소스와 서비스에 맞춰서
    - 넷플릭스는 대단..

## 4.2 기본 베스트 프랙티스
기본 원칙
1. 나의 관심사가 무엇인지 식별하고 측정 방법 고민
2. 최적화하기 용이한 부분이 아니라 중요한 부분을 최적화
3. 중요한 관심사를 먼저 다룸

### 4.2.1 하향식 성능
- 위에서부터 대규모 벤치마킹 하는게 세부적인 코드 섹션 별로 수치를 얻는 것보다 어려움

### 4.2.2 테스트 환경 구축
- 가급적 모든 면에서 운영 환경과 똑같이 복제 해야함
- 서버(cpu, os, 자바버전)...
- 운용중인 서비스도 목업 형태로 반영되어야 함
- 테스트 데이터도 

### 4.2.3 성능 요건 식별
- 성능 비기능 요건: 최적화 하려는 핵심 지표
- 시스템을 전체적으로 바라보며 중요한 측정값을 고려해야 함

### 4.2.4 자바의 특성 이슈
- jvm에는 복잡 미묘한 부분들이 있음
- 메모리 영역의 동적 튜닝 등 jvm특유의 자기 관리 기능이 추가되면서 복잡해짐
- JIT 컴파일 안되는경우:
    - 자주 실행되는 메서드가 아닌경우
    - 메소드가 너무 크고 복잡한 경우
- 핵심 단추는 로그를 남겨 잘 컴파일 되고 있는지 확인

### 4.2.5 SDLC 일부로 성능 테스트 수행
- 소프트웨어 성능 주기의 일부로 수행하고 성능 회귀테스트를 상시 수행
- 우리팀에서 이제 하려는.. 잘하고있구만

## 4.3 성능 안티패턴 개요
- 느낌: 이건 성능이 문제가아니라 그냥 개발자들의 폐단을 얘기한..

### 4.3.1 지루함
- 프로젝트에 지루함을 표출
- 그냥 sort 쓰면 되는데 정렬 알고리즘을 직접 구현
- 억지로 기술을 욱여넣거나 이상한거 갖다쓰기
- 공감... 개발놀이는 동아리에서

### 4.3.2 이력서 부풀리기
- 이력서를 포장하기 위해 프로젝트를 불필요한 방향으로 ㄲ르고감

### 4.3.3 피어프레셔
- 논의없이 기술 결정
- 섣불리 중요한 결정

### 4.3.4 이해 부족
- 지금 툴도 모르는데 새로운 툴로 해결하려는
- 하이버네이트 잘 모르고 쓰는것(공감)
- 무턱대고 쓰지말고 잘 알아보고 공부하고 쓰자

### 4.3.5 오해와 있지도 않은 문제
- 문제 자체가 무엇인지 제대로 이해하지 못한 채 오로지 기술을 이용해서 문제를 해결하려는 경우

## 4.4 성능 안티패턴 카탈로그

### 4.4.1 화려함에 사로잡히다
증상
- 최신의 멋진 기술을 튜닝 타깃으로 정함
흔히 하는 말
- 처음이라 말썽이 많군. 뭐가 문제인지 원인을 밝혀야 해
현실
- 어플리케이션을 측정, 튜닝하지 않고 신기술을 잘 모르면서 지레짐작으로..
- 온라인 예제는 작은 규모만 다루고있다는 함정
진단
- 오로지 최신의 뜨고있는 기술만 숭배
처방
- 측정을 해보고 진짜 병목을 찾고, 새 컴포넌트는 로그를 충분히 남기고 베스트 프랙티스를 참조하기

### 4.4.2 단순함에 사로잡히다
증상
- 전체적으로 어플리케이션을 프로파일링 하지 않고 간단한 부분만 파고듬
흔히 하는 말
- 일단 알고있는거만 해보자. XX님 휴가가서 돌아오면 이건 XX님한테 한번 봐달라 하자
현실
- 공유나 페어프로그래밍 없이 하다보니 그 개발자만 이 파트를 알게됨
진단
- 유지보수 팀에서 흔히 나타남. 
- 첫번째와 반대로 신기술 괜히 건들지 말고 익숙한거만 갖고 놀겠다는 방어 태세
처방
- 측정을 해보고 진짜 병목을 찾고, 잘 아는 전문가에게 도움 요청하고 전체 컴포넌트를 이해하도록 독려

### 4.4.3 성능 튜닝 도사
증상
- 성능 튜닝 도사를 채용
흔히 하는 말
- 나도 문제가 XX라는건 알고 있어
현실
- 마법사나 초인이 하는 일은 드레스코드에 도전하는 일이 전부
진단
- 개발 팀원들이 소외감을 느끼게 함. 조금만 최적화 해도 성능 향상
처방
- 또.. 측정을 해보고 진짜 병목을 찾고, 새로 채용된 도사가 다른 팀원들과 지식공유

### 4.4.4 민간 튜닝
증상
- 웹사이트만 보고 마법의 매개변수를 운영 서버에 적용
흔히 하는 말
- 스택 오버플로우에 이런 꿀팁이 있더라고~ 다 끝났어
현실
- 그 팁이 어떤 영향을 끼칠지 모름. 여기선 맞고 저기선 틀릴 수 있음
진단
- 성능 팁은 유통기한이 짧음. 계속 업데이트되고 하면 무용지물이 됨
- 자바 성능은 복잡한 다양한 요인이 영향을 미쳐서 전후 맥락 없이는 추론하기 가 어려움
처방
- 시스템에 영향을 미치는 기술은 충분히 파악
- UAT에서 시험해보고 철저히 검증
- 다른 개발자와 함께 설정을 리뷰하고 토의

### 4.4.5 안되면 조상 탓
증상
- 이슈와 상관없는 특정 컴포넌트를 문제 삼음
흔히 하는 말
- JMS, 하이버네이트 그 머시기 라이브러리가 항상 문제라니까
현실
- 충분한 분석도 안해보고 성급한 결론. 평소에 의심했던 범인을 유일한 용의자로 지목. 진짜 원인을 밝히기 위해 숲을 보지 앟음
진단
- 경영진, 영업팀이 주로 보이는 안티패턴
- 하이버네이트.. 잘쓰기 어렵고.. 참 어렵다
처방
- 정상적으로 분석하고 분석 결과를 모든 이해 관계자와 의논

### 4.4.6 숲을 못보고 나무만 보다
증상
- 전체적인 영향도 파악 없이 일단 변경해보고 국소적인 부분만 프로파일링
흔히 하는 말
- 이거만 바꾸면 성능이 나아질거야
현실
- 영향도를 이해한 사람이 없음. 바꾸고 프로파일링 안해봄. 전체 시스템 영향도를 파악하지 않음
진단
- JVM은 스위치만 수백개에 달하고 일단 디폴트 설정이랑 자기 관리 능력만으로 앵간하면 충분
- 복잡한 서브시스템을 제각기 풀어내는 괒어은 힘들다
- 운영을 그대로 모사한 UAT환경 없이 효용성 판단 어려움
- 부하가 높을때만 도움되고 부하가 없을땐 성능을 떨어뜨리는 최적화는 의미가 없음
처방
- 운영계 성능 지표 측정
- UAT에서 한번에 스위치 하나씩 변경
- 스트레스를 받는 지점이 UAT, 운영계가 동일한지 확인
- 운영계에서 일반적인 부하를 나타내는 테스트 데이터를 확보
- UAT에서 스위치를 변경하며 테스트
- UAT에서 다시 테스트
- 추론한 내용을 다른 사람에게 재검토 요청
- 결론을 다른 사람과 공유

### 4.4.7 내 데스크톱이 UAT
증상
- UAT환경이 운영이랑 다른 경우가 많음. 보통 개인장비가 더 성능이 좋음
흔히 하는 말
- UAT 환경을 완벽히 갖추려면 돈이 너무 많이 들어
현실
- UAT 환경이 운영계와 달라서 서비스가 중단되면 비용이 더 비쌈
진단
- 안하는것보단 뭐라도 해보는게 낫다는 낙관주의
처방
- 서비스 중단의 기회비용 따져보기. 운영환경과 동일하게 UAT. 

### 4.4.8 운영 데이터처럼 만들기는 어려워
증상
- 데이터 라이트. (찾아봐도없던데 이게 뭐지)
- 일부분만 포착해서 전부 돌리기 -> 버스트 전 웜업 포착불가
- 단순한 값만 사용 -> 데이터 현실성이 떨어짐
- 모든 값을 한꺼번에 시스템에 밀어넣음 -> 데이터 적재 비율이 달라질때 나타나는 웜업과 최적화를 놓치게 됨
흔히 하는 말
- 운영계 UAT 동기화 어려워요. 시스템에 맞게 데이터 조작하는건 삽질이지. 개발자는 운영데이터 접근 불가
현실
- 최대한 동일하게 맞춰야함
진단
- '뭐라도 해보는게 아무것도 안하는것 보단 낫지 않나'의 덫
처방
- 운영데이터를 UAT로 다시 이전하는 프로세스에 시간과 노력을 투자

반성
- 스테이징을...?!


## 4.5 인지 편향과 성능 테스트
- 인지 편향: 인간의 두뇌가 부정확한 결론을 내리게 이끄는 심리작용. 그런줄도 모르고 이성적이라고 믿음
- 위의 안티패턴들은 다 무의식중에 어떤 가정을 내리는 인지 편향
- 나머지 사례들은 저자의 궁시렁이므로 생략

### 4.5.1 환원주의
- 시스템의 시스템을 아주 작은 조각으로 나누어 구성 파트를 이해하면 전체 시스템도 다 이해할 수 있다는 사고방식

### 4.5.2 확증 편향
- 테스트 세트를 부실하게 선택하거나 결과를 통계적으로 분석하지 않으면..
- 강력한 동기 부여나 감정이 개입되기 때문에 거스르기 어려움(입증하려고 애씀)

### 4.5.3 전운의 그림자(행동 편향)
- 시스템이 예상대로 작동하지 않는 상황에서 발현되는 편향
- 영향도를 분석해보지도않고 알리지도 않고 인프라 변경
- 시스템이 의존하는 라이브러리를 변경
- 과거엔 시스템 중단 시나리오를 체계적으로 접근했는데 이건 인간 감정 영역에 속하는 문제라서 시스템이 가동을 멈춘 상황에서 여유가지기 어려움 

### 4.5.4 위험 편향
- 위험을 피하고 변화를 거부
- 단위 테스트랑 운영 리그레션 테스트만 잘 갖추고나면 리스크를 상당히 줄일 수 있음
- 위험 편향은 어플리케이션에 문제가 생겼을때 제대로 학습하고 제대로된 조치를 하지 않은 까닭에 더 고착화

### 4.5.5 엘스버그 역설
- 인간이 확률을 이해하는데 얼마나 서투른지 잘 보여줌
- 알려진 미지의 것을 추구하는 인간의 욕구에 관한 역설
- ... 이상한 말

## 4.6
성능 결과를 평가할 때는 데이터를 적절한 방법으로 처리하고 비과학적인 주관적인 사고에 빠지지 않도록 조심해야 함
