# 성능 최적화

## INTRO
- 자바 성능 튜닝 분야에서 **해결사** 란 없다
  - 성능 분석은 어떤 스위치를 키거나 꺼서 마법과 같은 일을 하는 것이 아니기 떼문
- 성능 분석은 경험 주의와 인간 심리학이 어우러진 분야
  - 관측 지표의 절대 수치 -> 어떤 Metric 을 측정하느냐
  - StakeHolder 가 해당 수치를 어떻게 받아들일지?
    - 예를 들어 결제의 경우 API 응답시간이 몇초 걸린다고 해도, 결제라는 결심을 가지고 일으킨 Action이기 때문에, 느린 api 응답은 수용되지만, 메인화면 로딩이 몇초 걸린다면 창을 꺼버릴 가능성이 크다

## 1.1 자바 성능: 잘못된 방법
- 대표적인 오해 : 메서드 디스패치 성능에 대한 얘기
  - 메서드 디스패치 : 이 메서드가 어느 객체의 어느 메서드이지?
  - low level 언어에서는 virtual table lookup 을 씀(vtable lookup이 뭔진 잘 기억안남 ㅎㅎ;;)
  - 메서드 포인터를 참조하지 않도록 메서드의 주소를 static 타임에 바인딩한다는 얘기인 것 같음
- 오해를 피하기 위해 정량적이고 검증가능한 튜닝이 필요하다.
  - 수명주기를 고려해야한다.
  - 테스트 이론
  - 측정, 통계, 툴링
  - 시스템 데이터 분석스킬
  - 하부 동작원리 이해하기
- 일반적인 원칙
  - 마법의 스위치는 없다
  - 팁, 트릭은 없다
  - 비밀 알고리즘도 없다.

## 1.2 자바 성능 개요
- 자바는 블루 칼라 언어
- 자바 초기 철학은 생산성에 맞췄다.
- GC같은 서브시스템으로 JVM의 복잡도를 올리는 대신, 생산성을 올리는 것
- 올라간 복잡도로 인해, 정규분포에서 벗어남
  - 정규분포 가정: 특정 지점에 몰리고, 그 지점에서 멀어갈 수록 확률이 낮아진다.
- 아웃라이어는 중요한 의미를 내포할 수 있다.

## 1.3 성능은 실험과학인다.
- 블루컬러 언어로 탄생된 자바가 JIT 와 같은 성능 튜닝이 이것저것 붙음
  - JIT로 인해 성능 결과가 워크로드 대비 선형적이지 않음
  - 따라서 성능 튜닝을 위한 딱 맞는 모델을 만들기 어려움
- JVM이 최상의 성능을 발휘할려면 어느 수준 이상의 스킬 (내부 구조이해 포함?)과 경험이 필요
- 명확하게 정의하지 않고 측정하는건 백해무익하다.
  - 결과 정의 -> 측정 -> 액션 -> 테스트
  - Management에서 맨날 나오는 PDCA 사이클
  - Plan Do Check Action

## 1.4 성능 분류
- 처리율: 단위 시간당 처리 량
- 지연: 하나의 요청이 처리되는데 걸리는 시간
- 용량: 병렬성
- 사용률: 리소스 할당률
- 효율: 처리율 / 리소스 사용률
- 확장성: 선형 확장 정도
- 저하: 꺾이는 정도
- 처리율에만 스펙 맞춰야한다 하지만, 다른 성능 관련 책에서는 다 맞춰야 한다고 함...
- 측정값은 모두 서로 연관되어있다. 풍선 효과
- 예시
  - 초당 500 개의 완료 응답이 간다 -> 처리율 500 TPS
  - 근데 요청 ~ 응답 시간 텀이 2초 -> 지연이 2초
  - 현재 시스템에 머물러있는 요청이 2x500 = 1000개 -> 병렬성 1000
  - 근데 서버 두대로 늘리니 처리율 900, 지연 1.5초
    - 확장성에서 처리율 100만큼, 지연 0.5초만큼 손해
  - 서버 한대에 초당 1000개의 요청을 보내니 처리율 400, 지연 3초 -> 저하
- Elbow Point
  - 어느 순간 성능이 급격하게 저하되는 지점
- 암달의 법칙
  - 병렬 컴퓨팅에서 시스템의 성능 향상은 순차적인 부분에 의해 제어된다.
  - 레디스 면접 대답하다가도 나옴...

