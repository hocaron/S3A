# 13 프로파일링
- 폰노이만 구조 -> 최근에는 인메모리 https://bit.ly/3K25TYV
- 그래서 프로파일링 할게 두개밖에 없다. 실행과 할당
- 프로파일링 작동 방식을 알아야 편향을 줄일 수 있다.

## 13.1 프로파일링 개요
- 대게 java agent 기반으로 동작함
    - premain 메서드로 바이트 코드를 조작해버림~
    - 뉴렐릭, datadog, pinpoint, scouter, scavanger 등등
- 모니터링 툴 vs 경고 시스템 vs 프로파일러
- 일단 뭐가 문제인지 알아야 하기 때먼에 프로파일링을 씀.
- 대신 그전에 GC 로그 등 다른 문제가 없는지 확인 필요

## 13.2 샘플링과 세이프포인트 편향
- 프로파일링은 샘플링으로 얻음 -> 트래픽이 그렇게 크지 않으면 모두 해두 됨...
    - GetCallTrace() 함수로 스레드의 스택 샘플을 가져오는데, 성능 이슈가 있을 수 있다~
- 세이프포인트편향
    - 세이프포인트에 있을 때만 프로파일링하므로 왜곡될 수 있다함.
    - 루프가 펼쳐지냐 안펼져지냐에 따라서 샘플링 결과가 좀 달라질 수 있음

## 13.3 개발자용 프로파일링 툴
- VisualVM, JProfiler, YourKit, 레드햇 서모스텟, 뉴렐릭, 어니스트 등등
- 화면 사용법이고, 프로파일러는 다양한게 있으므로 필요할 때 찾아보면 됨~

## 13.5 할당 프로파일링
- 메모리 할당 바이트코드 추적하는 예제코드 나오는데 패스....

## 13.6 힙 덤프 분석
- 진짜 중요한 파트를 짧게 써놓음
    - 힙덤프가 뭔지 안알려주고 툴 사용법만 알려줌
- 힙덤프란 말그대로 힙을 덤프 뜨는 것
- 힙에 어떤 객체들이 할당되어 있고 등등 힙 메모리의 전체를 찰칵 한다고 생각하면 됨
- 여기서부터는 뇌피셜 시작
    - 힙 덤프를 언제 뜨는가? -> OOM나서 꺼지면 힙덤프 뜨도록 JVM 플래그 세팅 or GC가 돌았는데 메모리 사용량이 줄지 않을 때 or 기분 내킬 때
    - jmap을 이용해서 힙 덤프를 뜰 수 있다.
    - https://hyperconnect.github.io/2022/10/07/troubleshoot-webclient-oom.html
    - https://techblog.woowahan.com/2628/
    - 보통은 라이브러리 버그...